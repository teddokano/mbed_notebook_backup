<p><span style="font-family: monospace, sans-serif;"><span><span>This is a personal memo to remember what I have done.<br>Writen in </span><strong>Japanese</strong><span> </span><strong>only</strong><span>, sorry. because this page contains no special things and/or local information.</span></span></span></p> <p><span style="font-family: monospace, sans-serif;">このページは<strong>日本語</strong>のみで書かれています．</span></p> <hr> <p><strong>個人用メモ: 未来の自分のために書いておく．以下は2009年11月27日と12月02日のメモから</strong></p> <hr> <h2>2009年11月27日: EthernetコネクタとSDカードアダプタ購入</h2> <hr> <p><span>26日夕方，秋葉原でRJ45コネクタとSDカードアダプタ，MicroSDカードアダプタを購入．</span></p> <p><span>ラジオデパート3Fの門田無線で<br>RJ45コネクタはサンハヤトのCK-18(610円)，コネクタと2.54mmピッチ変換基板つき．<br>SDカードコネクタも同社の変換基板付きCK-35(940円)．<br>これに加えブレッドボードSAD-11(2070円)とジャンパ線キットのSKS-290(3190円)も同店で購入(両方ともサンハヤト)．<br><br>他，千石電商で</span><strong>マイクロSDカード用</strong><span>の同様の</span><strong>コネクタ+基板</strong><span>を見つけたので購入(1050円)．<br>基板には「DAISEN C-MSD」のシルクがある．<br><br>27日は買ってきたRJ45コネクタでEthernetの動作を確認する．<br>mbedのHTTP_server例のページの情報を元に，接続してみる．<br><a href="http://mbed.org/projects/cookbook/wiki/EMAC">http://mbed.org/projects/cookbook/wiki/EMAC</a><br><br>CK-18の基板をそのままブレッドボードに挿すと，隣り合う各ピンがショートしてしまうので，パターンを切って配線．</span></p> <p><span>(しかしブレッドボードなんて触るの，20年ぶりぐらいかもしれない)<br><br>必要に応じてプロジェクトにライブラリをインポート．方法は上記URLに記載がある．<br>ソースをインポートすると，ビルドの度にそのソースがコンパイルされるため時間がかかる．<br>プリコンパイルしたものがあるのでそちらを使う．<br><a href="http://mbed.org/projects/cookbook/svn/EMAC/lwip/precomp">http://mbed.org/projects/cookbook/svn/EMAC/lwip/precomp</a><br><br>動かない．<br>ハブを介してDHCPからIPをもらい，USBシリアルにそのアドレスを表示するはずなのだが．<br>HTTPServer()のコールに引数を渡し，固定IPアドレスでも試してみるがダメ．<br><a href="http://mbed.org/projects/cookbook/api/EMAC/lwip/trunk/HTTPServer/HTTPServer#HTTPServer">http://mbed.org/projects/cookbook/api/EMAC/lwip/trunk/HTTPServer/HTTPServer#HTTPServer</a><br><br>一息ついた後，よくよくページを見てみたら，掲載されているコネクタ(SI-60002-F)はトランスやコモンモードチョーク内蔵のものだった．<br>買ってきたコネクタはどうやら「コネクタだけ」のものなのでどうしようもない．<br>無理やりではあるが，100Base-Tケーブルの結線を確認し，TD/RDの+/-それぞれに直接TX/RXの+/-をつないでみた．<br><br>これで動作は確認できた．<br>しかし問題点は以下の通り，<br></span></p> <ul> <li><span style="font-family: monospace, sans-serif; font-size: small;">「/」に置かれたファイルには問題なくアクセスできるが，サブディレクトリ中のファイルは不可のよう．...これはファイルIOの制限によるものかも知れないので別途確認要</span></li> <li><span style="font-family: monospace, sans-serif; font-size: small;">大きな画像ファイルの転送がうまくいかない．Index.htm内の&lt;img src&gt;ファイルに大きなサイズ(&gt;20kB以上)のものを使うと途中で転送が止まるなどの問題がある．...Ethernet部にトランスを入れたあるべき姿の回路で再実験を行う</span></li> </ul> <hr> <h2>2009年12月02日: Ethernetコネクタ(パルストランス入り)</h2> <hr> <p><span>Ethernet用のトランスを調べると，コネクタにそれを内蔵したものがあることがわかった．</span></p> <p><span>ネットの情報では，秋葉原の秋月とマルツパーツ館で入手可能なよう．しかし秋月のページでは在庫なしのサインが出ていたことからマルツへ向かう．1個420円<br><a href="https://www.marutsu.co.jp/user/shohin.php?p=64736">https://www.marutsu.co.jp/user/shohin.php?p=64736</a><br><br>ココで買ったパルストランス内蔵RJ-45コネクタはYuan Dean Scientific Co.,LTDの46F-1211<br><a href="http://www.yds.com.tw/driver/drivers/46-47F%20Series%20PDF%20Catalogue.pdf">http://www.yds.com.tw/driver/drivers/46-47F%20Series%20PDF%20Catalogue.pdf</a><br>ちなみにPHYのデータシートはここで確認できる<br><a href="http://www.national.com/pf/DP/DP83848J.html#Overview">http://www.national.com/pf/DP/DP83848J.html#Overview</a><br><br>このコネクタの接続は前回のトランスなしコネクタの接続と同じになっている．そのコネクタに付属していた変換基板がそのまま使えないかと思ったが，無理だったので，ユニバーサル基板を切ってブレッドボード用に配線する．</span></p> <p><span><img alt="" height="225" src="http://mbed.org/media/uploads/okano/ethernet10.jpg" width="300"><img alt="" height="225" src="http://mbed.org/media/uploads/okano/ethernet00.jpg" width="300"></span></p> <p><span>コネクタの向きなどに注意しながら配線，先日と同じコードを起動したら動いた．<br>大きな画像200KB程度を転送してみても問題は出ない．</span></p> <div> <hr> <h2><strong>2009年12月02日: SDカードアダプタ</strong></h2> </div> <div> <hr> <p><span>MicroSDカードアダプタを試してみる．</span></p> </div> <p>MicroSDカード・アダプタ基板には表面(ブレッドボードに挿した時に上になり，確認が可能な側)にピン番号，裏面に信号名が書いてある．</p> <p><img alt="" height="225" src="http://mbed.org/media/uploads/okano/sdcar.jpg" width="300"></p> <p><span>SDカードのライブラリのページを見ながら接続を確認．<br><a href="http://mbed.org/projects/cookbook/wiki/SDCard">http://mbed.org/projects/cookbook/wiki/SDCard</a><br><br>下記のページも参考にした．<br><a href="http://mycom1.at.webry.info/200811/article_10.html">http://mycom1.at.webry.info/200811/article_10.html</a><br><br>サンプルコードの通り，次のようにピンを初期化しているため5, 7, 6, 13のピンそれぞれをSDに接続する必要がある．<br></span></p> <pre>SDFileSystem sd(p5, p6, p7, p13, "sd");</pre> <pre>SDカード側(ピン名 : ピン番号)  --- mbed側ピン番号
DO/DAT  : 7       --- 6
Vss(Gnd): 6       ---
SCK/CLK : 5       --- 7
Vcc     : 4       --- VOUT
Vss     : 3       --- GND
CMD/DI  : 2       --- 5
CS/DAT3 : 1       --- 13
</pre> <p>しかしうまく動作しない．下のようなメッセージが出る．</p> <pre>Hello World!
Timeout waiting for card</pre> <p>オシロスコープで信号の様子を確認するとSDカードのpin7以外は正常に動いているよう．<br>pin7は決まったパターンのパルスしか出てないようでどうにも動かない．<br>そのうちmbedフォーラムでこのようなコメントを見つけた．<br><a href="http://mbed.org/forum/topic/202/?page=1#comment-869">http://mbed.org/forum/topic/202/?page=1#comment-869</a><br><br>手持ちのカードはSanDiskの1GB，そのほかはメーカ不明の2Gしかない．<br>ためしにその2GBで試すと下のようなメッセージが出る．</p> <pre>Hello World!
This disk tastes funny! I only like 512-byte blockscouldn't open file to read...</pre> <p>mbedのSDのページでは512バイト以外のブロックサイズは動作せず1GBよりも大きいサイズのカードはサポートしないとあったがその通りのよう．</p> <p><span> </span></p> <hr> <p><strong>*** 後日，別ブランドの1GB-MicroSDカードを購入して試したところ，問題なく動くことを確認した．</strong></p> <p><span> </span></p> <hr> <p><strong>SDカード容量の制限に関して...すでに解決されていたよう．</strong><br> 下のURLのリンクにあるコードで試したら，前に動かなかったSandiskの1GBやトランセンドの2GBも問題なく動作した．(2010 03/20)<br><a href="http://mbed.org/users/simon/notebook/sdcards/">http://mbed.org/users/simon/notebook/sdcards/</a></p> <p><strong><br></strong></p> <ul> </ul>